(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{206:function(_,t,v){"use strict";v.r(t);var a=v(0),s=Object(a.a)({},(function(){var _=this,t=_.$createElement,v=_._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h1",{attrs:{id:"集团下账流程梳理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#集团下账流程梳理"}},[_._v("#")]),_._v(" 集团下账流程梳理")]),_._v(" "),v("h2",{attrs:{id:"tam-bboss-pointpaybilltrade"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#tam-bboss-pointpaybilltrade"}},[_._v("#")]),_._v(" TAM_BBOSS_PointPayBillTrade")]),_._v(" "),v("ol",[v("li",[v("p",[_._v("传入包含Group_ID的集团信息列表,并填充传入的操作员信息")]),_._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[_._v("ROUTE_EPARCHY_CODE\nTRADE_EPARCHY_CODE\nTRADE_CITY_CODE\nTRADE_DEPART_ID\nTRADE_STAFF_ID\n")])])])]),_._v(" "),v("li",[v("p",[_._v("根据BIZ_TYPE_CODE从表TD_B_BBOSSITEM中查询费用项与帐目对应关系参数")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[_._v("NOTE_ITEM\nINTEGRATE_ITEM_CODE\nBIZ_TYPE_CODE 为集团产品ID\nTAX_RATE 税率\nMIX_ITEM_ID 拆分账目\n\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("select")]),_._v(" FLAG"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v(" NOTE_ITEM"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v(" INTEGRATE_ITEM_CODE"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v(" BIZ_TYPE_CODE "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("TAX_RATE"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("MIX_ITEM_ID  "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("from")]),_._v(" TD_B_BBOSSITEM "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("where")]),_._v(" flag "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[_._v("0")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("and")]),_._v(" BIZ_TYPE_CODE "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),_._v(" :BIZ_TYPE_CODE"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])])]),_._v(" "),v("li",[v("p",[_._v("查询取集团代付的渠道编码")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("Select")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("*")]),_._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("from")]),_._v(" TD_B_COMMPARA "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("where")]),_._v(" PARA_CODE"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'ASM_GROUP_CHANNELID'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])])]),_._v(" "),v("li",[v("p",[_._v("根据集团用户ID(USER_ID)查询集团默认付费账户")])]),_._v(" "),v("li",[v("p",[_._v("应收处理PAY_TAG=0")]),_._v(" "),v("p",[_._v("5.1 查询账前还是帐后调账参数")]),_._v(" "),v("div",{staticClass:"language-sql extra-class"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token comment"}},[_._v("-- 1:帐前 ，默认为帐后")]),_._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("select")]),_._v(" PARA_CODE1 "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("from")]),_._v(" TD_B_COMMPARA "),v("span",{pre:!0,attrs:{class:"token keyword"}},[_._v("where")]),_._v(" PARA_CODE"),v("span",{pre:!0,attrs:{class:"token operator"}},[_._v("=")]),v("span",{pre:!0,attrs:{class:"token string"}},[_._v("'ASM_ADJUST_PARAM'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(";")]),_._v("\n")])])]),v("p",[_._v("5.2 组装下账参数")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("参数名称")]),_._v(" "),v("th",[_._v("参数取值")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("USER_ID")]),_._v(" "),v("td",[_._v("通过成员手机号或者用户查询TF_F_USER表获取USER_ID字段")])]),_._v(" "),v("tr",[v("td",[_._v("ACCT_ID")]),_._v(" "),v("td",[_._v("集团默认账户")])]),_._v(" "),v("tr",[v("td",[_._v("SERIAL_NUMBER")]),_._v(" "),v("td",[_._v("集团成员号码")])]),_._v(" "),v("tr",[v("td",[_._v("EPARCHY_CODE")]),_._v(" "),v("td",[_._v("使用的ROUTE_EPARCHY_CODE,跟TRADE_EPARCHY_CODE一样")])]),_._v(" "),v("tr",[v("td",[_._v("CYCLE_ID")]),_._v(" "),v("td",[_._v("BCYC_ID")])]),_._v(" "),v("tr",[v("td",[_._v("ADJUST_TYPE")]),_._v(" "),v("td",[_._v("0 // 退费")])]),_._v(" "),v("tr",[v("td",[_._v("ADJUST_MODE")]),_._v(" "),v("td",[_._v("0 //按金额")])]),_._v(" "),v("tr",[v("td",[_._v("SVC_TYPE")]),_._v(" "),v("td",[_._v("5 // 成员账单调账入库 ,新增类型5")])]),_._v(" "),v("tr",[v("td",[_._v("OPERATE_TYPE")]),_._v(" "),v("td",[_._v("帐后调帐1,帐前调帐0,根据ASM_ADJUST_PARAM参数值取的")])]),_._v(" "),v("tr",[v("td",[_._v("RETURN_KIND")]),_._v(" "),v("td",[_._v("1")])]),_._v(" "),v("tr",[v("td",[_._v("FEE")]),_._v(" "),v("td",[_._v("0")])]),_._v(" "),v("tr",[v("td",[_._v("ADJUST_FEE")]),_._v(" "),v("td",[_._v("传入的金额fee处理逻辑 long finFee = fee / 10; "),v("br"),_._v("if (fee % 10 > 0)    ++finFee;")])]),_._v(" "),v("tr",[v("td",[_._v("ADJUST_REASON_CODE")]),_._v(" "),v("td",[_._v("0")])]),_._v(" "),v("tr",[v("td",[_._v("REMARK")]),_._v(" "),v("td",[_._v("全网代付账单调账补费")])]),_._v(" "),v("tr",[v("td",[_._v("ACCT_DAY")]),_._v(" "),v("td",[_._v("账期日")])]),_._v(" "),v("tr",[v("td",[_._v("OUT_TRADE_ID")]),_._v(" "),v("td",[_._v("通过SEQ_CHARGE_ID取的序列")])]),_._v(" "),v("tr",[v("td",[_._v("INTEGRATE_ITEM_CODE")]),_._v(" "),v("td",[_._v("跨省改号业务账前调账补费账目项")])]),_._v(" "),v("tr",[v("td",[_._v("MIX_ITEM_ID")]),_._v(" "),v("td",[_._v("拆分账目")])]),_._v(" "),v("tr",[v("td",[_._v("TAX_RATE")]),_._v(" "),v("td",[_._v("税率")])]),_._v(" "),v("tr",[v("td",[_._v("NO_TAX_FEE")]),_._v(" "),v("td",[_._v("不含税金额noTaxFee = (fee * 100000 / (10000 + taxRate) + 5) / 10;")])]),_._v(" "),v("tr",[v("td",[_._v("TAX")]),_._v(" "),v("td",[_._v("税额taxFee = finFee - noTaxFee;")])])])]),_._v(" "),v("p",[_._v("5.3 使用组装的参数列表调用调帐提交接口TAM_Audit_AdjustSubmit")])]),_._v(" "),v("li",[v("p",[_._v("实收处理PAY_TAG=1")]),_._v(" "),v("p",[_._v("6.1 填充参数")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段")]),_._v(" "),v("th",[_._v("取值")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("X_PAY_ACCT_ID")]),_._v(" "),v("td",[_._v("集团默认账户")])]),_._v(" "),v("tr",[v("td",[_._v("X_PAY_USER_ID")]),_._v(" "),v("td",[_._v("集团成员用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("X_PAY_SERIAL_NUMBER")]),_._v(" "),v("td",[_._v("集团虚拟成员号码")])]),_._v(" "),v("tr",[v("td",[_._v("EPARCHY_CODE")]),_._v(" "),v("td",[_._v('"" 空字符')])]),_._v(" "),v("tr",[v("td",[_._v("REMOVE_TAG")]),_._v(" "),v("td",[_._v("0")])]),_._v(" "),v("tr",[v("td",[_._v("TRADE_FEE")]),_._v(" "),v("td",[_._v("long finFee = fee / 10; "),v("br"),_._v("if (fee % 10 > 0)    ++finFee;"),v("br"),_._v("fee为传入集合所有费用相加")])]),_._v(" "),v("tr",[v("td",[_._v("PAYMENT_ID")]),_._v(" "),v("td",[_._v("1")])]),_._v(" "),v("tr",[v("td",[_._v("PAY_FEE_MODE_CODE")]),_._v(" "),v("td",[_._v("0")])]),_._v(" "),v("tr",[v("td",[_._v("CHANNEL_ID")]),_._v(" "),v("td",[_._v("select PARA_CODE1 from TD_B_COMMPARA "),v("br"),_._v("where PARA_CODE='ASM_GROUP_CHANNELID'; // 集团代付渠道")])]),_._v(" "),v("tr",[v("td",[_._v("REMARK")]),_._v(" "),v("td",[_._v("BBOSS实收")])])])]),_._v(" "),v("p",[_._v("6.2 使用填充的参数调用异步缴费接口TAM_AsyncRecvFee")])])]),_._v(" "),v("h2",{attrs:{id:"tam-bboss-pointpaybilladjust-接口"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#tam-bboss-pointpaybilladjust-接口"}},[_._v("#")]),_._v(" TAM_BBOSS_PointPayBillAdjust 接口")]),_._v(" "),v("p",[_._v("跟TAM_BBOSS_PointPayBillTrade接口逻辑大致相同,区别在5.3")]),_._v(" "),v("p",[_._v("5.3逻辑替换为将数据插入TF_B_ADJUST_CHK表")]),_._v(" "),v("p",[_._v("其他逻辑跟TAM_BBOSS_PointPayBillTrade接口一致")])])}),[],!1,null,null,null);t.default=s.exports}}]);