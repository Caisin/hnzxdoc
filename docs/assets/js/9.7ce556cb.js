(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{208:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"重点业务排重设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重点业务排重设计"}},[s._v("#")]),s._v(" 重点业务排重设计")]),s._v(" "),a("h2",{attrs:{id:"_1-配置表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置表"}},[s._v("#")]),s._v(" 1.配置表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Create table")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    PAGE_NAME   VARCHAR2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    ID_KEY      VARCHAR2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    EXPIRE_TIME NUMBER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    OPERATOR    VARCHAR2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    STATE       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'U'")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    PCTFREE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n    INITRANS "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n    MAXTRANS "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" TBS_PARAM_CFG_DAT_01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'重点业务排重配置表'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PAGE_NAME "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'页面名称'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ID_KEY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'页面请求号码的key,如cond_ACCESS_NO'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXPIRE_TIME "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'唯一ID失效时间,单位ms,默认一分钟'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OPERATOR "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'配置添加人'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("comment")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("STATE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'状态U:启用,E:失效'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Create/Recreate primary, unique and foreign key constraints")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" PARAM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AM_REPEAT_CHECK_CONFIG\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("constraint")]),s._v(" PK_AM_REPEAT_CHECK_CONFIG "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("page_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("\n            PCTFREE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n            INITRANS "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n            MAXTRANS "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" TBS_PARAM_CFG_IND_01\n            NoLogging\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ol",[a("li",[a("p",[s._v("页面查询方法通过getPageName()取到页面名称pageName")])]),s._v(" "),a("li",[a("p",[s._v("通过pageName查询AM_REPEAT_CHECK_CONFIG表")])]),s._v(" "),a("li",[a("p",[s._v("有配置,则保存到redis,并根据配置设置失效时间")])])]),s._v(" "),a("ul",[a("li",[s._v('key: pageName+":"+三户ID(通过配置的ID_KEY取值)')]),s._v(" "),a("li",[s._v("value: true")]),s._v(" "),a("li",[s._v("这个值没有什么用,知识用key标识是否会重复,提交完key会删除")]),s._v(" "),a("li",[s._v("每次请求都会重置")])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[s._v("提交")])]),s._v(" "),a("li",[a("p",[s._v("根据页面的key从redis取值")])]),s._v(" "),a("li",[a("p",[s._v("取到说明请求是有效的")])]),s._v(" "),a("li",[a("p",[s._v("取不到说明请求无效,报错")])]),s._v(" "),a("li",[a("p",[s._v("将生成的唯一流水作为外部流水传到后台")])]),s._v(" "),a("li",[a("p",[s._v("后台可以再次校验")])]),s._v(" "),a("li",[a("p",[s._v("提交成功,删除key")])]),s._v(" "),a("li",[a("p",[s._v("失败重置失效时间")])])]),s._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("graph LR\nA[查询] --\x3eB(获取唯一ID)\n    B --\x3e C[页面保存]\n    \n    D[提交]--\x3eE[校验唯一ID]\n    E--\x3eF[以外部流水计入业务日志]\n")])])]),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("graph LR\n\tsubgraph 查询流程\n        Start(开始) --\x3eQuery[/三户ID/]\n        Query --\x3e IsKeyBusi{是否重点业务}\n        IsKeyBusi --\x3e|是| QCfg[查询配置表]--\x3eGenKey[根据配置生成唯一ID]\n        IsKeyBusi --\x3e|否| E[返回页面]\n        GenKey--\x3eE\n    end\n    subgraph 提交流程\n    \tCommit(提交)--\x3eif{是否重点业务}\n    if--\x3e|是|ck[校验唯一序列]--\x3eck{重复是/否?}\n    end\n    \n    \n    \n")])])]),a("p",[s._v("3.重点业务一定要考虑排重机制，话单处理、累账要有查重、缴费要有服务锁、赠送要记录已经送的(再次执行报错)、")]),s._v(" "),a("p",[s._v("缴费要判断唯一流水已经上账的不能重复上账、")]),s._v(" "),a("p",[s._v("短信发送要判断已经发过的不能再发、")]),s._v(" "),a("p",[s._v("调账已经调过的不能再处理等等；")]),s._v(" "),a("p",[s._v("配置表加个序列的配置(该业务的记录表主键的序列),")]),s._v(" "),a("p",[s._v("唯一ID就是通过配置的序列去调服务取序列值,存到redis")]),s._v(" "),a("p",[s._v("请求发送到后台,通过传入的唯一序列作为主业务记录的主键ID")])])}),[],!1,null,null,null);t.default=e.exports}}]);